# BGP-ัะพะพะฑัะตะฝะธั ะธ ัะฐะทะฑะพั ะฟะฐะบะตัะพะฒ

BGP ะธัะฟะพะปัะทัะตั 4 ัะธะฟะฐ ัะพะพะฑัะตะฝะธะน:

- OPEN
- UPDATE
- NOTIFICATION
- KEEPALIVE

ะะฐััะผะพััะธะผ ะธั ัะพัะผะฐัั ะธ ะฟัะธะผะตัั ะธะท Wireshark.

---

## ะะฑัะธะน ัะพัะผะฐั BGP-ัะพะพะฑัะตะฝะธั

| ะะพะปะต             | ะะฐะทะผะตั (ะฑะฐะนั) | ะะฟะธัะฐะฝะธะต |
|------------------|--------------|--------|
| Marker          | 16           | 0xFF... ะดะปั ัะธะฝััะพะฝะธะทะฐัะธะธ |
| Length          | 2            | ะะฑัะฐั ะดะปะธะฝะฐ (ะผะธะฝ 19) |
| Type            | 1            | 1=OPEN, 2=UPDATE ะธ ั.ะด. |

> ๐ก Marker ะฒัะตะณะดะฐ 16 ะฑะฐะนั `0xFFFF...`, ะธัะฟะพะปัะทัะตััั ะบะฐะบ ัะธะฝััะพะฝะธะทะฐัะธั ะฟะพัะพะบะฐ.

---

## 1. OPEN-ัะพะพะฑัะตะฝะธะต (Type 1)

ะะฝะธัะธะธััะตั BGP-ัะตััะธั.

### ะคะพัะผะฐั:

| ะะพะปะต               | ะะฐะทะผะตั |
|--------------------|--------|
| Version            | 1 (ะพะฑััะฝะพ 4) |
| My Autonomous System | 2    |
| Hold Time          | 2 (ัะตะบัะฝะดั) |
| BGP Identifier     | 4 (router-id) |
| Optional Parameters Length | 1 |
| Optional Parameters | ะฟะตัะตะผะตะฝะฝะฐั |

### ะะฐะทะฑะพั (ะฟัะธะผะตั)
48 48 48 48 ... (16 ะฑะฐะนั Marker)\
00 2B โ ะดะปะธะฝะฐ 43 ะฑะฐะนัะฐ\
01 โ ัะธะฟ OPEN\
04 โ ะฒะตััะธั BGPv4\
00 01 โ AS = 1\
C0 00 01 01 โ Hold Time = 4096, BGP ID = 192.0.1.1\
00 โ Optional Parameters Length\



---

## 2. UPDATE-ัะพะพะฑัะตะฝะธะต (Type 2)

ะัะฝะพะฒะฝะพะต ัะพะพะฑัะตะฝะธะต โ ะฟะตัะตะดะฐัะฐ ะฟัะตัะธะบัะพะฒ.

### ะคะพัะผะฐั:

| ะะพะปะต                     | ะะฟะธัะฐะฝะธะต |
|--------------------------|--------|
| Unfeasible Routes Length | ะะปะธะฝะฐ ัะฟะธัะบะฐ ัะดะฐะปัะตะผัั ะผะฐัััััะพะฒ |
| Withdrawn Routes         | ะกะฟะธัะพะบ ะฟัะตัะธะบัะพะฒ ะดะปั ัะดะฐะปะตะฝะธั |
| Total Path Attribute Length | ะะปะธะฝะฐ ะฐััะธะฑััะพะฒ |
| Path Attributes          | ORIGIN, AS_PATH ะธ ะดั. |
| Network Layer Reachability Information (NLRI) | ะะพะฒัะต ะฟัะตัะธะบัั |

### ะัะธะผะตั ัะฐะทะฑะพัะฐ

**ะฃะดะฐะปะตะฝะธะต ะผะฐัััััะฐ:**
- Withdrawn Routes: `192.0.2.0/24`

**ะะพะฑะฐะฒะปะตะฝะธะต ะผะฐัััััะฐ:**
- AS_PATH: `64500, 3356`
- NEXT_HOP: `10.0.0.2`
- NLRI: `203.0.113.0/24`

> ๐งฉ MP-BGP ะธัะฟะพะปัะทัะตั **MP_REACH_NLRI** ะธ **MP_UNREACH_NLRI** ะดะปั IPv6, VPN ะธ ะดั.

---

## 3. NOTIFICATION (Type 3)

ะัะฟัะฐะฒะปัะตััั ะฟัะธ ะพัะธะฑะบะต. ะัะธะผะตัั:

| Error Code       | Subcode           |
|------------------|-------------------|
| Message Header   | Connect not synchronized |
| OPEN Message     | Unsupported version |
| UPDATE Message   | Invalid AS_PATH |
| Hold Timer Expired | โ |

ะัะธะผะตั: `Error: 4 (Hold Timer Expired), Subcode: 0`

---

## 4. KEEPALIVE (Type 4)

- ะะปะธะฝะฐ 19 ะฑะฐะนั.
- ะะตั ะฟะพะปะตะทะฝะพะน ะฝะฐะณััะทะบะธ.
- ะัะฟัะฐะฒะปัะตััั ะบะฐะถะดัะต **hold-time / 3**.

---

## Finite State Machine (FSM)

BGP-ัะตััะธั ะฟัะพัะพะดะธั 6 ัะพััะพัะฝะธะน:

1. **Idle** โ ะฟัะพัะตัั ะทะฐะฟััะตะฝ.
2. **Connect** โ ะพะถะธะดะฐะฝะธะต TCP.
3. **Active** โ ะฟะพะฟััะบะฐ ะฟะพะดะบะปััะตะฝะธั.
4. **OpenSent** โ ะพัะฟัะฐะฒะปะตะฝ OPEN.
5. **OpenConfirm** โ ะฟะพะปััะตะฝ OPEN.
6. **Established** โ ะพะฑะผะตะฝ UPDATE.

> ๐ ะัะปะธ ะพัะธะฑะบะฐ โ ะฒะพะทะฒัะฐัะฐะตััั ะฒ Idle.

---