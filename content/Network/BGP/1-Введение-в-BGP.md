# –í–≤–µ–¥–µ–Ω–∏–µ –≤ BGP

## –ß—Ç–æ —Ç–∞–∫–æ–µ BGP?

**Border Gateway Protocol (BGP)** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª –º–µ–∂–¥–æ–º–µ–Ω–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è –æ–±–º–µ–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –º–µ–∂–¥—É –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (AS) –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ.

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ (IGP: OSPF, IS-IS, EIGRP), BGP –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ **–∞—Ç—Ä–∏–±—É—Ç–æ–≤** –∏ **–ø–æ–ª–∏—Ç–∏–∫**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ.

> üîó **RFC 4271** ‚Äî —Ç–µ–∫—É—â–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç BGPv4 (1995), —Ö–æ—Ç—è –ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è ‚Äî RFC 1105 (1989).

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ BGP

1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–æ—Å–µ–¥–µ–π (peers)** —á–µ—Ä–µ–∑ TCP-—Å–µ—Å—Å–∏—é (port 179).
2. **–û–±–º–µ–Ω –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏** (IPv4, IPv6, VPN –∏ –¥—Ä.).
3. **–í—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–∏—Ç–∏–∫ –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤.
4. **–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏).

---

## BGP –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ Internet

```text
[ AS 64500 ] ‚îÄ‚îÄ‚îÄ eBGP ‚îÄ‚îÄ‚îÄ> [ AS 3356 (Verizon) ] <‚îÄ‚îÄ‚îÄ eBGP ‚îÄ‚îÄ‚îÄ [ AS 15169 (Google) ]
       ‚îÇ                             ‚îÇ
      iBGP                         iBGP
       ‚îÇ                             ‚îÇ
 [ Routers inside ]           [ Routers inside ]
```

**eBGP (External BGP)** ‚Äî –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ AS.

**iBGP (Internal BGP)** ‚Äî –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π AS.

üí° **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** iBGP –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç NEXT_HOP –∏ AS_PATH, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç eBGP.

## –ü–æ—á–µ–º—É BGP —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ TCP?
BGP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TCP-—Å–µ—Å—Å–∏—é (–ø–æ—Ä—Ç 179) –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –ù–µ –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–µ.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤).
- –õ–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —Ñ–∞–µ—Ä–≤–æ–ª–∞–º–∏ (–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ—Ä—Ç).

‚ö†Ô∏è **–ü–æ—Ç–µ—Ä—è TCP-—Å–µ—Å—Å–∏–∏ = –æ–±—Ä—ã–≤ BGP-—Å–µ—Å—Å–∏–∏ = –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–æ–≤.**

## BGP ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –≤–µ–∫—Ç–æ—Ä–∞ –ø—É—Ç–µ–π
BGP ‚Äî path-vector protocol, —Ç–æ –µ—Å—Ç—å –æ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç:

- –°–ø–∏—Å–æ–∫ AS, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ (AS_PATH).
- –ê—Ç—Ä–∏–±—É—Ç—ã, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä AS_PATH:**
```
AS_PATH: 64500 3356 15169
```
–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: –º–∞—Ä—à—Ä—É—Ç –≤ 15169 –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ 3356, –∏ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ 64500.


## –°—Ç–∞—Ç—É—Å—ã BGP (–∫—Ä–∞—Ç–∫–æ)

| –°—Ç–∞—Ç—É—Å         | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
|----------------|-------------------------------------------|
| **Idle**       | –ó–∞–ø—É—Å–∫, –æ–∂–∏–¥–∞–Ω–∏–µ TCP                      |
| **Connect**    | –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ TCP                          |
| **OpenSent**   | –û—Ç–ø—Ä–∞–≤–ª–µ–Ω OPEN                            |
| **OpenConfirm**| –ü–æ–ª—É—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ OPEN               |
| **Established**| –°–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞, –æ–±–º–µ–Ω UPDATE              |

> –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî –≤ 4-–º —Ñ–∞–π–ª–µ.

---

## –í—ã–≤–æ–¥

BGP ‚Äî —ç—Ç–æ **"—Å–∫–µ–ª–µ—Ç" –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞**. –ë–µ–∑ –Ω–µ–≥–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –º–µ–∂–¥–æ–º–µ–Ω–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è. –û–Ω –Ω–µ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π, –Ω–æ **—Å–∞–º—ã–π –≥–∏–±–∫–∏–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π** –ø—Ä–æ—Ç–æ–∫–æ–ª –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏.