# –¢–∏–ø—ã BGP-—Å–µ–∞–Ω—Å–æ–≤

BGP –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ —Å–µ—Å—Å–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π.

---

## eBGP (External BGP)

- –ú–µ–∂–¥—É **—Ä–∞–∑–Ω—ã–º–∏ AS**.
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é TTL=1 (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏).
- –ò–∑–º–µ–Ω—è–µ—Ç AS_PATH (–¥–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–π AS).
- –ò–∑–º–µ–Ω—è–µ—Ç NEXT_HOP (–Ω–∞ —Å–µ–±—è).
- –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–æ **–Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–º—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é** (—Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∏–ª–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ loopback + multihop).

> üîê –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π `ebgp-multihop` —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ.

---

## iBGP (Internal BGP)

- –ú–µ–∂–¥—É —Ä–æ—É—Ç–µ—Ä–∞–º–∏ **–≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π AS**.
- TTL –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è.
- **AS_PATH –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è**.
- **NEXT_HOP –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Üí –Ω—É–∂–µ–Ω IGP –∏–ª–∏ `next-hop-self`.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è iBGP

- **–ù–µ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç** –º–∞—Ä—à—Ä—É—Ç—ã –º–µ–∂–¥—É iBGP-—Å–æ—Å–µ–¥—è–º–∏ (–Ω–µ—Ç "iBGP split horizon").
- –¢—Ä–µ–±—É–µ—Ç **full mesh** –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã.

> ‚ùó –ö–∞–∂–¥—ã–π iBGP-—Å—É—Å–µ–¥ –¥–æ–ª–∂–µ–Ω "—É–≤–∏–¥–µ—Ç—å" –º–∞—Ä—à—Ä—É—Ç –æ—Ç eBGP-—Å–æ—Å–µ–¥–∞.

---

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ iBGP: Route Reflectors

**Route Reflector (RR)** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å full mesh.

   [ RR ]
  /   |   \
[C1] [C2] [C3]



- RR –ø–æ–ª—É—á–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥—Ä—É–≥–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º.
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã:
  - `ORIGINATOR_ID` ‚Äî router-id –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
  - `CLUSTER_LIST` ‚Äî —Å–ø–∏—Å–æ–∫ cluster.

> ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å–µ–º–∏ –≤–µ–Ω–¥–æ—Ä–∞–º–∏: Cisco, Juniper, Nokia, FRR –∏ –¥—Ä.

---

## Confederations

–ü–æ–¥—Ä–∞–∑–¥–µ–ª—è–µ—Ç –±–æ–ª—å—à—É—é AS –Ω–∞ –ø–æ–¥-AS, –∏—Å–ø–æ–ª—å–∑—É—è **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π eBGP**.

```text
AS 64500:
  Sub-AS: 64501, 64502, 64503
```
- –í–Ω—É—Ç—Ä–∏ sub-AS ‚Äî iBGP –∏–ª–∏ RR.
- –ú–µ–∂–¥—É sub-AS ‚Äî eBGP (–Ω–æ –≤–∏–¥–Ω–æ –∫–∞–∫ iBGP –≤–Ω–µ—à–Ω–∏–º).

‚ö†Ô∏è –°–ª–æ–∂–Ω–µ–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ, –Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

## –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Å–µ—Å—Å–∏—è (Loopback)
BGP-—Å–µ—Å—Å–∏—è —á–∞—Å—Ç–æ –∏–¥—ë—Ç –º–µ–∂–¥—É loopback-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏:

- –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
```aiignore
R1:
 neighbor 10.0.0.2 remote-as 64500
 neighbor 10.0.0.2 update-source loopback0

R2:
 neighbor 10.0.0.1 remote-as 64500
 neighbor 10.0.0.1 update-source loopback0
```

–¢—Ä–µ–±—É–µ—Ç—Å—è IGP –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è loopback.

## Multihop eBGP
–ò–Ω–æ–≥–¥–∞ eBGP –Ω–µ –Ω–∞ –ø—Ä—è–º–æ–º –ª–∏–Ω–∫–µ:
```aiignore
R1 (AS1) ‚Äî SW ‚Äî R2 (AS2)
```
–ù–∞—Å—Ç—Ä–æ–π–∫–∞:
```aiignore
# Cisco
neighbor X.X.X.X ebgp-multihop 2

# Juniper
multipath multiple-as;
peer-as 64500;
local-address 10.0.0.1;
üîê –ò—Å–ø–æ–ª—å–∑—É–π GTSM (Generalized TTL Security) –¥–ª—è –∑–∞—â–∏—Ç—ã.
```
