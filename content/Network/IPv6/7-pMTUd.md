# pMTUd

**Path MTU Discovery (pMTUd)** — это механизм определения максимального размера пакета (MTU),
который может быть передан по маршруту без фрагментации.\
В IPv6 он критически важен, так как фрагментация возможна только на источнике (в отличие от IPv4, где маршрутизаторы могут фрагментировать пакеты).

Минимальный размер для IPv6 = 1280 байт

## Как работает pMTUd?

Цель: Найти минимальный MTU на пути от отправителя к получателю.\
Механизм: Использует ICMPv6 Packet Too Big (тип 2) для обнаружения "узких" мест.

1. Хост отправляет пакет с размером, равным MTU своего интерфейса (например, 1500 байт для Ethernet).
2. Если на пути встречается маршрутизатор с меньшим MTU (например, 1280 байт):
  - Маршрутизатор отбрасывает пакет.
  - Отправляет ICMPv6 Packet Too Big с указанием нового MTU.
3. Отправитель уменьшает MTU до значения из ICMPv6-сообщения.\
Процесс повторяется, пока не будет найден минимальный MTU пути.

Вот картинка для наглядности и потому что могу:

![Пакетик](images/network/ipv6_6.jpg)  
*Source: [Курс: Основы протокола IPv6](https://clck.ru/3N26hi)*

## PLPMTUD

Есть ещё PLPMTUD (RFC 8899) - это улучшенная версия pMTUd для работы в условиях блокировки ICMP:
- Использует таймауты и повторные передачи для обнаружения MTU. 
- Применяется в TCP, QUIC и других протоколах.

### Сравнение с IPv4
| Параметр           | IPv4                                    | IPv6                   |
|:-------------------|:----------------------------------------|------------------------|
| Фрагментация       | Маршрутизаторы могут фрагментировать    | Только отправитель     |
| Ошибки MTU         | ICMP Fragmentation Needed               | ICMPv6 Packet Too Big  |
| Минимальный MTU    | 576 байт                                | 1280 байт              |



