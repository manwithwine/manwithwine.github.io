# SLAAC

**SLAAC** — это механизм автоматической настройки IPv6-адресов без использования DHCP-сервера.\
Он позволяет устройствам самостоятельно генерировать валидные IPv6-адреса на основе информации, полученной от маршрутизаторов.

## Как работает SLAAC?

Процесс состоит из 3 ключевых этапов:

1. Получение префикса сети:\
Хост отправляет [Router Solicitation (RS)](4-NDP.md#rs) и получает [Router Advertisement (RA)](4-NDP.md#ra).
2. Хост создаёт адрес по схеме:\
```
[64-битный префикс] + [64-битный идентификатор интерфейса]
```
Идентификатор интерфейса может формироваться двумя способами:
- **EUI-64** - преобразование MAC-адреса по стандарту IEEE:
  - Берется MAC-адрес: <span style="color:orange">00:11:22:</span><span style="color:pink">33:44:55</span>
  - Вставляется ff:fe в середину: <span style="color:orange">00:11:22:</span><span style="color:yellow">ff:fe:</span><span style="color:pink">33:44:55</span>
  - Инвертируется 7-й бит первого байта: <span style="color:red">02:</span><span style="color:orange">11:22:</span><span style="color:yellow">ff:fe:</span><span style="color:pink">33:44:55</span>
    - Оригинальный MAC-адрес: 00:11:22:ff:fe:33:44:55
    - Первый байт — 00: 00 (hex) = 00000000 (binary)
    - Инвертируем = поменять с 0 на 1: 00000000 → 00000010 = 0x02
    - Таким образом получаем ~~мысль о суициде~~:  <span style="color:orange">00 → <span style="color:red">02</span>
  - Преобразуется в IPv6-формат: <span style="color:green">0211:22ff:fe33:4455
- **Privacy Extensions** - случайный идентификатор (RFC 4941):
  - Вместо EUI-64 используется псевдослучайно сгенерированный интерфейсный идентификатор:
    - На основе хеш-функции, текущего времени, счётчика, секретного ключа и др. 
    - Идентификатор меняется периодически.
  - Создаётся временный IPv6-адрес, например: 2001:db8:abcd:1234:78da:1bc3:2f1a:1234 
  - Через заданный интервал (например, 1 день) адрес удаляется, и создаётся новый. 
  - Для исходящих соединений по умолчанию используется именно временный адрес. 
  - При этом сохраняется постоянный адрес (EUI-64) для получения входящих соединений (если они нужны).
3. Проверка уникальности ([DAD](3-Multicast.md#dad))

### Параметры времени жизни

Также в [RA](4-NDP.md#ra) указываются:
- Valid Lifetime: сколько адрес остается валидным (обычно 30 дней)
- Preferred Lifetime: сколько адрес предпочтителен для новых соединений (обычно 7 дней)
  - После истечения Preferred Lifetime:
    - Новые соединения используют другой адрес
    - Существующие соединения продолжают работать

### Отличие от DHCPv6
| Параметр      | SLAAC                         | DHCPv6                      |
|---------------|-------------------------------|:----------------------------|
| Тип           | Stateless (без состояния)     | Stateful/Stateless          |
| Адреса        | Генерируются на хосте         | Выдаются сервером           |
| DNS/NTP       | Только через RDNSS или DHCPv6 | Через DHCPv6                |
| Управление    | Децентрализованное            | Централизованное            |
