# Типы маршрутов в EVPN

## Type 1. Ethernet Auto-Discovery (A-D) Route

_**ДЛЯ ОБЪЯВЛЕНИЯ ETHERNET SEGMENT IDENTIFIER (ESI) (КОНВЕРГЕНЦИЯ, БАЛАНСИРОВКА)**_

Данный маршрут не несет информации о MAC-адресах, но имеет очень широкое применение, такое как:     
- Автоматический поиск PE маршрутизаторов, к которым подключен один и тот же CE-маршрутизатор
- Анонс ESI метки
- Анонс массовой отмены изученных MAC-адресов
- Анонс Aliasing метки

Маршрут типа 1 может анонсироваться per-EVI или per-ESI.\
Первый анонс используется при анонсировании Aliasing метки, второй — для возможности массовой отмены анонсированных MAC-адресов какого-либо ethernet сегмента.

## Type 2. MAC/IP Advertisement Route

**_ДЛЯ АНОНСА ИНФОРМАЦИИ О ПОДКЛЮЧЕННЫХ ХОСТАХ_**

Этот маршрут используется для обмена информацией о MAC- и IP-адресах устройств в сети EVPN. \
Он обеспечивает пересылку трафика между устройствами, основываясь на информации о MAC-адресах. \
Когда устройство отправляет пакет данных, содержащий MAC-адрес назначения, маршруты MAC/IP Advertisement используются для определения маршрута пересылки пакета до правильного получателя.

Cостоит из:
```aiignore
RD — Route Distinguisher.
Ethernet Segment Identifier — идентификатор ESI.
Ethernet Tag ID — номер влана.
MAC Address Length — длина MAC-адреса, по сути всегда 48 бит.
MAC Address — сам MAC-адрес
IP Address Length — длина IP-адреса, для IPv4 равна 32 битам, и для IPv6 — 128. Данное поле опционально и может не содержать никаких значений (все нули).
IP Address — сам адрес. Поле заполняется опционально.
MPLS Label1|2 — непосредственно сама метка.

```

**Важно знать, что есть два типа Type-2 маршрутов:**\
**MAC only**:
используется исключительно для свитчинга в bridge-домене

**Mac-IP**:
используется для маршрутизации и является по своей сути ARP записью.

## Type 3. Inclusive Multicast Ethernet Tag Route

**_ДЛЯ РАБОТЫ С BUM ТРАФИКОМ_**

Задача данного маршрута сообщить о типе распространения BUM трафика с помощью PIM или Ingress Replication.\
Генерируется каждым PE маршрутизатором.

Состоит из:
```aiignore
RD — Route Distinguisher.
Ethernet Tag ID — это номер влана
IP Address Length — длина IP-адреса, указанного в следующем поле.
Originating Router’s IP Address — IP-адрес оригинатора маршрута, как правило лупбек PE маршрутизатора.
```

## Type 4. Ethernet Segment Route

**_ДЛЯ ВЫБОРА DF (КТО УПРАВЛЯЕТ BUM) ДЛЯ ИЗБЕЖАНИЯ ПЕТЕЛЬ В MULTI-HOMING СЦЕНАРИИ_**

Этот маршрут используется для идентификации сегментов Ethernet в сети EVPN. \
Он помогает устройствам определить, к какому сегменту находится прикреплено отправляющее/получающее устройство. \
Маршруты Ethernet Segment также обеспечивают создание эффективного пути для пересылки трафика между сегментами.

## Type 5. IP Prefix Route

**_ДЛЯ АНОНСА ВНЕШНИХ МАРШРУТОВ В ФАБРИКУ_**

Данный тип маршрута анонсирует подсети, тот же дефолтный маршрут.
Используется для пересылки трафика между различными IP-подсетями в сети EVPN. \
IP Prefix маршруты обеспечивают устройствам информацию о доступных IP-подсетях и позволяют маршрутизаторам выбирать наиболее подходящий путь для доставки пакетов данных к их назначению.

Есть еще:
```aiignore
Type 6-8
ДЛЯ РАСПРОСТРАНЕНИЯ PIM, IGMP LEAVE/JOIN ПО ФАБРИКЕ
```



*Source: [linkmeup](https://clck.ru/3PcsDe)*

