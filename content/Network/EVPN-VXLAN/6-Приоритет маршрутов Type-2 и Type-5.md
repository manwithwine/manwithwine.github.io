# Приоритет Type-2 и Type-5 маршрутов в EVPN/VXLAN для Symmetric/Asymmetric IRB

В Symmetric IRB приоритетным маршрутом для связи между узкими сетями (subnets) является Type-5 (IP Prefix Route).
потому что он явно и наиболее эффективно описывает маршрут до целой подсети, расположенной на удаленном VTEP. \
Type-2 (MAC/IP Route) используется для связи внутри одной подсети (L2) и для разрешения ARP.

Почему Type5 является приоритетным для Symmetric IRB?

Допустим, у нас есть:
```aiignore
VTEP-1: Хост A (IP-A) в подсети 10.1.10.0/24.

VTEP-2: Хост B (IP-B) в подсети 10.2.20.0/24.
```

- VTEP-1 объявляет два маршрута:
  - Type2: MAC-A + IP-A 
  - Type5: 10.1.10.0/24

- VTEP-2 изучает эти маршруты. Когда Host B хочет связаться с Host A, трафик приходит на VTEP-2.
Таблица маршрутизации (IP-VRF) на VTEP-2:
```aiignore
10.1.10.0/24 [Type5] -> next-hop VTEP-1

IP-A/32 [Type2] -> next-hop VTEP-1
```

Процесс поиска маршрута (Longest Prefix Match):
- Пакет предназначен для IP-A. 
- Оба маршрута ведут к одному и тому же Next Hop (VTEP-1).
- Но маршрут /32 (созданный из Type2) является более специфичным, чем маршрут /24 (созданный из Type5).

**ОШИБОЧНОЕ предположение**: Казалось бы, должен использоваться Type2.

- Ключевой момент (EVPN Order of Preference):\
В EVPN существует четкое правило приоритета при установке маршрутов в RIB/FIB:
```aiignore
Type5 > Type2
```

То есть, если существует и Type-5 (префикс), и Type-2 (/32 хост) для одного и того же назначения, BGP предпочтет Type-5.\
Это сделано намеренно, чтобы агрегировать трафик на уровне подсетей и избежать необходимости устанавливать миллионы /32 маршрутов для каждого хоста.

В Asymmetric IRB для межподсетевой маршрутизации используется только Type-2, так как маршрутизация происходит только на ingress VTEP.